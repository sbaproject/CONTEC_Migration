VERSION 5.00
Object = "{0D181820-63E5-11D1-8959-E995CE93D831}#2.3#0"; "Threed5.OCX"
Begin VB.Form WLS_PRN 
   Appearance      =   0  'Ã◊Øƒ
   BackColor       =   &H00C0C0C0&
   BorderStyle     =   3  'å≈íË¿ﬁ≤±€∏ﬁ
   Caption         =   "í†ï[ñàÇÃÉvÉäÉìÉ^ÇÃê›íËÇ∆ãLò^"
   ClientHeight    =   3720
   ClientLeft      =   2925
   ClientTop       =   4605
   ClientWidth     =   8295
   ClipControls    =   0   'False
   ControlBox      =   0   'False
   ForeColor       =   &H80000008&
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   PaletteMode     =   1  'Z µ∞¿ﬁ∞
   ScaleHeight     =   3720
   ScaleWidth      =   8295
   Begin VB.Frame Frame4 
      Caption         =   "ïWèÄópéÜÉTÉCÉYÇ∆àÛç¸ÇÃå¸Ç´"
      Height          =   855
      Left            =   120
      TabIndex        =   16
      Top             =   2520
      Width           =   4455
      Begin Threed5.SSPanel5 PNL_DefSize 
         Height          =   300
         Left            =   720
         TabIndex        =   20
         Top             =   300
         Width           =   2295
         _ExtentX        =   4048
         _ExtentY        =   529
         BackColor       =   12632256
         ForeColor       =   -2147483640
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
            Size            =   9
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         BevelOuter      =   1
         Caption         =   "A4"
      End
      Begin Threed5.SSPanel5 PNL_DefOrient 
         Height          =   300
         Left            =   3720
         TabIndex        =   19
         Top             =   300
         Width           =   495
         _ExtentX        =   873
         _ExtentY        =   529
         BackColor       =   12632256
         ForeColor       =   -2147483640
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "ÇlÇr ÇoÉSÉVÉbÉN"
            Size            =   9
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         BevelOuter      =   1
         Caption         =   "èc"
      End
      Begin VB.Label Label5 
         Caption         =   "å¸Ç´"
         Height          =   255
         Left            =   3360
         TabIndex        =   18
         Top             =   360
         Width           =   375
      End
      Begin VB.Label Label4 
         Caption         =   "ª≤Ωﬁ"
         Height          =   255
         Left            =   240
         TabIndex        =   17
         Top             =   360
         Width           =   495
      End
   End
   Begin VB.ListBox LstKyusi 
      Height          =   420
      Left            =   1305
      TabIndex        =   15
      Top             =   4770
      Width           =   825
   End
   Begin VB.ListBox LstForm 
      Height          =   420
      Left            =   135
      TabIndex        =   10
      Top             =   4770
      Width           =   825
   End
   Begin VB.Frame Frame3 
      Caption         =   "àÛç¸ÇÃå¸Ç´"
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   9
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1185
      Left            =   5175
      TabIndex        =   8
      Top             =   1170
      Width           =   2130
      Begin VB.OptionButton OptOrient 
         Caption         =   "â°"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   9
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   375
         Index           =   1
         Left            =   1305
         TabIndex        =   12
         TabStop         =   0   'False
         Top             =   720
         Width           =   735
      End
      Begin VB.OptionButton OptOrient 
         Caption         =   "èc"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   9
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   375
         Index           =   0
         Left            =   1305
         TabIndex        =   11
         TabStop         =   0   'False
         Top             =   270
         Width           =   735
      End
      Begin VB.Image ImgOrient 
         Height          =   465
         Left            =   405
         Top             =   450
         Width           =   465
      End
   End
   Begin VB.Frame Frame2 
      Caption         =   "ópéÜ"
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   9
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1185
      Left            =   90
      TabIndex        =   6
      Top             =   1170
      Width           =   4965
      Begin VB.ComboBox CmbKyusi 
         Height          =   300
         Left            =   945
         Style           =   2  'ƒﬁ€ØÃﬂ¿ﬁ≥› ÿΩƒ
         TabIndex        =   13
         TabStop         =   0   'False
         Top             =   720
         Width           =   3840
      End
      Begin VB.ComboBox CmbForm 
         Height          =   300
         Left            =   945
         Style           =   2  'ƒﬁ€ØÃﬂ¿ﬁ≥› ÿΩƒ
         TabIndex        =   9
         TabStop         =   0   'False
         Top             =   270
         Width           =   3840
      End
      Begin VB.Label Label3 
         Caption         =   "ããéÜï˚ñ@"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   9
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   240
         Left            =   135
         TabIndex        =   14
         Top             =   765
         Width           =   780
      End
      Begin VB.Label Label2 
         Caption         =   "ª≤Ωﬁ"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   9
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   240
         Left            =   135
         TabIndex        =   7
         Top             =   315
         Width           =   555
      End
   End
   Begin VB.Frame Frame1 
      Caption         =   "Ãﬂÿ›¿"
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   9
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   915
      Left            =   90
      TabIndex        =   3
      Top             =   135
      Width           =   8115
      Begin VB.ComboBox CmbPrn 
         Height          =   300
         Left            =   990
         Style           =   2  'ƒﬁ€ØÃﬂ¿ﬁ≥› ÿΩƒ
         TabIndex        =   4
         TabStop         =   0   'False
         Top             =   315
         Width           =   6090
      End
      Begin VB.CommandButton CmdProper 
         Caption         =   "Ãﬂ€ ﬂ√®"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   9
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   7020
         TabIndex        =   2
         Top             =   315
         Width           =   1005
      End
      Begin VB.Label Label1 
         Caption         =   "Ãﬂÿ›¿ñº"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   9
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   240
         Left            =   135
         TabIndex        =   5
         Top             =   360
         Width           =   780
      End
   End
   Begin VB.CommandButton WLSOK 
      Appearance      =   0  'Ã◊Øƒ
      BackColor       =   &H80000005&
      Caption         =   "OK"
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   9
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   405
      Left            =   5265
      TabIndex        =   0
      Top             =   2805
      Width           =   990
   End
   Begin VB.CommandButton WLSCANCEL 
      Appearance      =   0  'Ã◊Øƒ
      BackColor       =   &H80000005&
      Caption         =   "∑¨›æŸ"
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   9
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   420
      Left            =   6645
      TabIndex        =   1
      Top             =   2805
      Width           =   990
   End
   Begin VB.Image ImgLib 
      Height          =   405
      Index           =   1
      Left            =   2925
      Picture         =   "WLS_PRN.frx":0000
      Top             =   4725
      Width           =   465
   End
   Begin VB.Image ImgLib 
      Height          =   465
      Index           =   0
      Left            =   2340
      Picture         =   "WLS_PRN.frx":0A62
      Top             =   4725
      Width           =   420
   End
End
Attribute VB_Name = "WLS_PRN"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit
Dim SelDM As DEVMODE
Dim SavDevice As String
Dim dspflg As Boolean


Private Sub CmbForm_Click()
    
    If dspflg Then Exit Sub
    SelDM.dmPaperSize = LstForm.List(CmbForm.ListIndex)
    SelDM.dmFormName = CmbForm.List(CmbForm.ListIndex) & Chr(0)
    WLSOK.SetFocus
End Sub

Private Sub CmbKyusi_Click()
    
    If dspflg Then Exit Sub
    SelDM.dmDefaultSource = LstKyusi.List(CmbKyusi.ListIndex)
    WLSOK.SetFocus
End Sub

Private Sub CmbPrn_Click()
    
    If dspflg Then Exit Sub
    If CmbPrn.List(CmbPrn.ListIndex) <> SavDevice Then
        Call GetDevMode(CmbPrn.List(CmbPrn.ListIndex), DM_OUT_BUFFER)
    End If
    WLSOK.SetFocus
End Sub

Private Sub CmbPrn_GotFocus()
    SavDevice = CmbPrn.List(CmbPrn.ListIndex)
End Sub

Private Sub CmdProper_Click()
    
    Call GetDevMode(CmbPrn.List(CmbPrn.ListIndex), DM_IN_BUFFER Or DM_IN_PROMPT Or DM_OUT_BUFFER)
    WLSOK.SetFocus
End Sub

Private Sub Form_Activate()
    Me.Enabled = False
    'WLSOK.Left = (WLS_PRN.Width - (WLSOK.Width + WLSCANCEL.Width + 60)) / 2
    'WLSCANCEL.Left = WLSOK.Left + WLSOK.Width + 60
    DoEvents
    If GetUsePrinter(SelDM) Then
        Call DisplayPrinter
    Else
        Call GetDevMode(GetDefDevice(), DM_OUT_BUFFER)
    End If
    Me.Enabled = True
    WLSOK.SetFocus
End Sub

Private Sub Form_Load()
    Dim I%
    
    WLS_PRN.Top = (Screen.Height - WLS_PRN.Height) / 2
    WLS_PRN.Left = (Screen.Width - WLS_PRN.Width) / 2
    For I = 0 To Printers.count - 1
        CmbPrn.AddItem Printers(I).DeviceName
    Next
    'Default ópéÜÉTÉCÉYÇ∆àÛç¸å¸Ç´Çï\é¶
    PNL_DefSize.Caption = SSS_DefPaperSizeNm
    If SSS_DefOrient = 2 Then
        PNL_DefOrient.Caption = "â°"
    Else
        PNL_DefOrient.Caption = "èc"
    End If
    Call Init_Prompt
End Sub

Function GetDefDevice() As String
    Dim DEF$
    Dim di&
    Dim npos%

    DEF$ = String$(128, 0)
    di = GetProfileString("WINDOWS", "DEVICE", "", DEF$, 127)
    '#Start(2003.5.20) ÉvÉäÉìÉ^Ç™ÉCÉìÉXÉgÅ[ÉãÇ≥ÇÍÇƒÇ¢Ç»Ç¢èÍçáÇÃÉâÉìÉ^ÉCÉÄÉGÉâÅ[ÇñhÇÆ
    If di = 0 Then
        MsgBox "Ç±ÇÃÇoÇbÇ…ÇÕÉvÉäÉìÉ^Ç™ÉCÉìÉXÉgÅ[ÉãÇ≥ÇÍÇƒÇ¢Ç»Ç¢ÇÊÇ§Ç≈Ç∑ÅB" & vbCr & "í†ï[ÉvÉçÉOÉâÉÄÇÃé¿çsÇ…ÇÕÉvÉäÉìÉ^(ÉhÉâÉCÉo)Ç™ïKê{Ç≈Ç∑ÅB" & vbCr & "ÉCÉìÉXÉgÅ[ÉãÇµÇƒâ∫Ç≥Ç¢ÅB" & vbCr & "Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\Å\" & vbCr & "ÉvÉäÉìÉ^(ÉhÉâÉCÉoÅjÇ™Ç»Ç¢èÍçáÇÕÅAê≥ÇµÇ≠é¿çsÇ≥ÇÍÇ»Ç¢â¬î\ê´Ç™Ç†ÇËÇ‹Ç∑ÅB", vbExclamation
        GetDefDevice = ""
        Exit Function
    End If
    '#End(2003.5.20)
    DEF$ = agGetStringFromLPSTR$(DEF$)
    npos% = InStr(DEF$, ",")
    '#Start(2003.5.20) ÉvÉäÉìÉ^ñºÇ™127ÉoÉCÉgÇí¥Ç¶ÇÈéûÇÃÉâÉìÉ^ÉCÉÄÉGÉâÅ[ÇñhÇÆ
    If npos < 1 Then
        MsgBox "ÉvÉäÉìÉ^ñºÇ…àŸèÌÇ™Ç†ÇÈÇÊÇ§Ç≈Ç∑ÅB" & vbCr & "ÉvÉäÉìÉ^ñºÇÃí∑Ç≥Ç™127ÉoÉCÉgà»ì‡Ç…ÇµÇƒâ∫Ç≥Ç¢ÅB", vbExclamation
        GetDefDevice = ""
        Exit Function
    End If
    '#End(2003.5.20)
    GetDefDevice = Left$(DEF$, npos% - 1)

End Function

Sub GetDevMode(ByVal dv As String, ByVal fmode As Long)
    Dim hPrinter&, res&
    Dim pdefs As PRINTER_DEFAULTS
    Dim bufsize&
    Dim dmInBuf() As Byte
    Dim dmOutBuf() As Byte
    Dim I%
    pdefs.PDATATYPE = vbNullString
    pdefs.PDEVMODE = 0
'    pdefs.DesiredAccess = PRINTER_ACCESS_ADMINISTER
    pdefs.DESIREDACCESS = PRINTER_ACCESS_USE
    
    '#Start(2003.11.17) CR9 Unicode ëŒâû
    Dim UniDv() As Byte
    
    UniDv = dv & Chr(0)
    ' OpenPrinterBynum ÇÃ3Ç¬ñ⁄ÇÃÉpÉâÉÅÅ[É^Ç…ÇÕ 0 ÇéwíËÇ≈Ç´Ç‹Ç∑Ç™ÅA
    ' ëSÇƒÇÃÉvÉäÉìÉ^ÉvÉçÉpÉeÉBÇÕï“èWÇ≈Ç´Ç»Ç≠Ç»ÇËÇ‹Ç∑ÅB
    'res& = OpenPrinter(dv, hPrinter, pdefs)
    res& = OpenPrinter(UniDv(0), hPrinter, pdefs)
    '#End(2003.11.17)
    
'    res& = OpenPrinterBynum(devname$, hPrinter, 0)
    If res = 0 Then Exit Sub

    '#Start(2003.11.17) CR9 Unicode ëŒâû
    'bufsize = DocumentProperties(Me.hwnd, hPrinter, dv, 0, 0, 0)
    bufsize = DocumentProperties(Me.hwnd, hPrinter, UniDv(0), 0, 0, 0)
    '#End(2003.11.17)

    If bufsize < Len(SelDM) Then bufsize = Len(SelDM)
    ReDim dmInBuf(bufsize)
    ReDim dmOutBuf(bufsize)
    agCopyData SelDM, dmInBuf(0), Len(SelDM)

    '#Start(2003.11.17) CR9 Unicode ëŒâû
    'res = DocumentProperties(Me.hwnd, hPrinter, dv, agGetAddressForObject(dmOutBuf(0)), agGetAddressForObject(dmInBuf(0)), fmode)
    res = DocumentProperties(Me.hwnd, hPrinter, UniDv(0), agGetAddressForObject(dmOutBuf(0)), agGetAddressForObject(dmInBuf(0)), fmode)
    '#End(2003.11.17)
    
    ' ÉfÅ[É^ÉoÉbÉtÉ@Ç DEVMODE ç\ë¢ëÃÇ÷ÉRÉsÅ[
    Select Case res
    Case IDOK
'        For i = 0 To 2000
'            If dmInBuf(i) <> dmOutBuf(i) Then
'                MsgBox i
'                Exit For
'            End If
'        Next
        agCopyData dmOutBuf(0), SelDM, Len(SelDM)
'2000/10/19 àÍçsí«â¡Å@í∑Ç¢ÉvÉäÉìÉ^ñºÇ…ëŒâû
        SelDM.LongDeviceName = RTrim$(dv) & Chr(0)
        'ÉfÉtÉHÅ[ÉãÉgópéÜÉTÉCÉYÇ∆àÛéöå¸Ç´Ç™ìoò^Ç≥ÇÍÇƒÇ¢ÇÈèÍçáÅAÇªÇÍÇÉfÉtÉHÅ[ÉãÉgÇ…
        '#Start(2002.2.27) ÉvÉäÉìÉ^ÉvÉçÉpÉeÉBÇ≈ÇÃéwíËÇ…è]Ç§ÇÃÇ≈ÅAéüÇÃÇQçsÇäOÇ∑
        'SelDM.dmOrientation = SSS_DefOrient
        'SelDM.dmPaperSize = SSS_DefPaperSize
        '#End(2002.2.27)
        Call DisplayPrinter
    Case IDCANCEL
    Case Else
        MsgBox "ÉvÉäÉìÉ^ÇÃèÓïÒÇ™éÊìæÇ≈Ç´Ç‹ÇπÇÒÅB", 0, "ÉvÉäÉìÉ^ÇÃê›íË"
    End Select
    ClosePrinter hPrinter
End Sub

Sub DisplayPrinter()
    Dim devname$, devoutput$
    Dim count&
    Dim names$
    Dim a$, S$
    Dim di&
    Dim I%, J%
    Dim NoBuf() As Byte
    Dim No%
    
    CmbForm.Clear
    LstForm.Clear
    CmbKyusi.Clear
    LstKyusi.Clear
    
    dspflg = True
    If (CmbPrn.ListCount > 0) And (CmbPrn.ListIndex < 0) Then CmbPrn.ListIndex = 0
'2000/10/19 ÇPçsïœçXÅ@í∑Ç¢ÉvÉäÉìÉ^ñºÇ…ëŒâû
'    devname$ = agGetStringFromLPSTR$(SelDM.dmDeviceName)
    devname$ = agGetStringFromLPSTR$(SelDM.LongDeviceName)
    For I = 0 To CmbPrn.ListCount - 1
        If CmbPrn.List(I) = devname$ Then
            CmbPrn.ListIndex = I
            Exit For
        End If
    Next
    
'    devname$ = CmbPrn.List(CmbPrn.ListIndex)
'    devoutput$ = GetDeviceOutput$(dev$)
    devoutput = ""

    ' égópâ¬î\Ç»ópéÜÉTÉCÉYÇéÊìæÇµÇ‹Ç∑ÅB
    count = DeviceCapabilities(devname$, devoutput$, DC_PAPERNAMES, vbNullString, 0)
    If count <= 0 Then
        MsgBox "égópâ¬î\Ç»ópéÜÉTÉCÉYÇÃèÓïÒÇ™éÊìæÇ≈Ç´Ç‹ÇπÇÒÅB", 0, "ÉvÉäÉìÉ^ÇÃê›íË"
        Exit Sub
    End If

    ' èÓïÒÇï€éùÇ≈Ç´ÇÈè\ï™Ç»óÃàÊÇämï€ÇµÇ‹Ç∑ÅB
    names$ = String$(64 * count, 0)
    di = DeviceCapabilities(devname$, devoutput$, DC_PAPERNAMES, names$, 0)
    
    ' égópâ¬î\Ç»ópéÜÉTÉCÉYÇéÊìæÇµÇ‹Ç∑ÅB
    count = DeviceCapabilitiesNo(devname$, devoutput$, DC_PAPERS, 0, 0)
    If count <= 0 Then
        MsgBox "égópâ¬î\Ç»ópéÜÉTÉCÉYÇÃèÓïÒÇ™éÊìæÇ≈Ç´Ç‹ÇπÇÒÅB", 0, "ÉvÉäÉìÉ^ÇÃê›íË"
        Exit Sub
    End If

    ' èÓïÒÇï€éùÇ≈Ç´ÇÈè\ï™Ç»óÃàÊÇämï€ÇµÇ‹Ç∑ÅB
    ReDim NoBuf(2 * count)
    di = DeviceCapabilitiesNo(devname$, devoutput$, DC_PAPERS, agGetAddressForObject(NoBuf(0)), 0)

    ' éÊìæÇµÇΩèÓïÒÇï\é¶ÇµÇ‹Ç∑ÅB
    For I = 0 To count - 1
        No = NoBuf(I * 2) + NoBuf(I * 2 + 1) * 256
        LstForm.AddItem No
        a$ = MidWid(names$, I * 64 + 1, 64)
        a$ = agGetStringFromLPSTR$(a$)
        CmbForm.AddItem a$
        If No = SelDM.dmPaperSize Then
            CmbForm.ListIndex = I
        End If
    Next
    
    ' égópâ¬î\Ç»ópéÜÉTÉCÉYÇéÊìæÇµÇ‹Ç∑ÅB
    count = DeviceCapabilities(devname$, devoutput$, DC_BINNAMES, vbNullString, 0)
    If count <= 0 Then
        MsgBox "égópâ¬î\Ç»ópéÜÉTÉCÉYÇÃèÓïÒÇ™éÊìæÇ≈Ç´Ç‹ÇπÇÒÅB", 0, "ÉvÉäÉìÉ^ÇÃê›íË"
        Exit Sub
    End If

    ' èÓïÒÇï€éùÇ≈Ç´ÇÈè\ï™Ç»óÃàÊÇämï€ÇµÇ‹Ç∑ÅB
    names$ = String$(24 * count, 0)
    di = DeviceCapabilities(devname$, devoutput$, DC_BINNAMES, names$, 0)
    
    ' égópâ¬î\Ç»ópéÜÉTÉCÉYÇéÊìæÇµÇ‹Ç∑ÅB
    count = DeviceCapabilitiesNo(devname$, devoutput$, DC_BINS, 0, 0)
    If count <= 0 Then
        MsgBox "égópâ¬î\Ç»ópéÜÉTÉCÉYÇÃèÓïÒÇ™éÊìæÇ≈Ç´Ç‹ÇπÇÒÅB", 0, "ÉvÉäÉìÉ^ÇÃê›íË"
        Exit Sub
    End If

    ' èÓïÒÇï€éùÇ≈Ç´ÇÈè\ï™Ç»óÃàÊÇämï€ÇµÇ‹Ç∑ÅB
    ReDim NoBuf(2 * count)
    di = DeviceCapabilitiesNo(devname$, devoutput$, DC_BINS, agGetAddressForObject(NoBuf(0)), 0)

    ' éÊìæÇµÇΩèÓïÒÇï\é¶ÇµÇ‹Ç∑ÅB
    For I = 0 To count - 1
        No = NoBuf(I * 2) + NoBuf(I * 2 + 1) * 256
        LstKyusi.AddItem No
        a$ = MidWid(names$, I * 24 + 1, 24)
        a$ = agGetStringFromLPSTR$(a$)
        CmbKyusi.AddItem a$
        If No = SelDM.dmDefaultSource Then
            CmbKyusi.ListIndex = I
        End If
    Next
    
    If SelDM.dmOrientation = DMORIENT_PORTRAIT Then
        OptOrient(0) = True
        ImgOrient.Picture = ImgLib(0).Picture
    Else
        OptOrient(1) = True
        ImgOrient.Picture = ImgLib(1).Picture
    End If
    dspflg = False
End Sub


Private Sub OptOrient_Click(Index As Integer)
    If dspflg Then Exit Sub
    ImgOrient.Picture = ImgLib(Index).Picture
    If Index = 0 Then
        SelDM.dmOrientation = DMORIENT_PORTRAIT
    Else
        SelDM.dmOrientation = DMORIENT_LANDSCAPE
    End If
    WLSOK.SetFocus
End Sub

Private Sub WLSCANCEL_CLICK()
    '
    Unload Me
End Sub

Private Sub WLSOK_Click()
    Call PutUsePrinter(SelDM)
    Unload Me
End Sub
